<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<head>
	<meta charset="utf-8">
	<title>Private Chat</title>
	<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
	<link href="index.css" rel="stylesheet">
</head>
<body>
    <div id="wrap-showtexts"></div>
    <div id="msgbox" class="msgbox"></div>
    <div id="wrap-input">
		<textarea type="text" id="getText" placeholder="Enter your text"></textarea><br><br>
		<div class="flex-button">
			<button OnClick="getText()">Refresh</button>
			<button OnClick="submitText()">Send</button>
		</div>
	</div>
	<!-- <div class="copyright">
		&copy; Encrypted
	</div> -->
</body>
<script>
	// var username = window.prompt("Please Enter Username")
	// var private_key = window.prompt("Please Enter Private Key")
	var username = 'das'
	function submitText(){
		var text=document.getElementById('getText').value
		var senddata={"text":text, "date":Date().toString().slice(4, 24), "sender":username}
		axios.post('https://myp-chat.firebaseio.com/chat.json',senddata).then(function(res){
			// document.getElementById('msgbox').innerHTML="Message Sent"
			document.getElementById('getText').value=""
			getText()
			// document.getElementById('msgbox').innerHTML=""
		})
	}
	window.onload=getText()
	function getText(){
		var allTexts=[]
		var url = 'https://myp-chat.firebaseio.com/chat.json?orderBy="$key"&limitToLast=5'
		var url2 = 'https://script.google.com/macros/s/AKfycbzxWw-sFLslbSCCOYxwculKb4JAZGd4sUjUXPZY2GvpJFKoFf4/exec'
		var uid = {
			"provider": "anonymous",
			"uid": "1"
		}
		axios.get(url2).then(function(res){
			allTexts=[]
			for(let key in res.data){
				res.data.id=key;
				allTexts.push(res.data[key])
			}
			// allTexts.reverse()
		}).then(function(res){
			for( let  i in allTexts){
				var elem=document.createElement('div')
					elem.setAttribute('id','box'+i)
					elem.setAttribute('class','box')
					// elem.innerHTML=allTexts[i].text
					elem.innerHTML=res
					document.getElementById('wrap-showtexts').appendChild(elem)
				var elem2=document.createElement('div')
					elem2.setAttribute('class','date')
					elem2.innerHTML=allTexts[i].date + " " + allTexts[i].sender
					document.getElementById('wrap-showtexts').appendChild(elem2)					
			}
			allTexts=[]
			window.scrollTo(0,document.body.scrollHeight)
		})
	}
</script>
</html>
