<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<head>
	<meta charset="utf-8">
	<title>Private Chat</title>
	<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
	<link href="index.css" rel="stylesheet">
<!-- 	<style>
        
	</style> -->
</head>
<body>
    <div id="wrap-showtexts"></div>
    <div id="msgbox" class="msgbox"></div>
    <div id="wrap-input">
		<textarea type="text" id="getText" placeholder="Enter your text"></textarea><br><br>
		<div class="flex-button">
			<button OnClick="getText()">Refresh</button>
			<button OnClick="submitText()">Send</button>
		</div>
	</div>
	<!-- <div class="copyright">
		&copy; Encrypted
	</div> -->
</body>
<script>
// 	var private_key = window.prompt("Please Enter Private Key")
	var private_key = "1"
	var allTexts=[]
	function submitText(){
		var text=document.getElementById('getText').value
		var senddata={"text":text, "date":Date().toString().slice(4, 24), "sender":private_key}
		axios.post('https://texter-for-me.firebaseio.com/text.json',senddata).then(function(res){
			// document.getElementById('msgbox').innerHTML="Message Sent"
			document.getElementById('getText').value=""
			deleteBox()
			getText()
			// document.getElementById('msgbox').innerHTML=""
		})
	}
	window.onload=getText()
	function getText(){
		axios.get('https://texter-for-me.firebaseio.com/text.json?orderBy=%22$key%22&limitToLast=5').then(function(res){
			allTexts=[]
			for(let key in res.data){
				res.data.id=key;
				allTexts.push(res.data[key])
			}
			// allTexts.reverse()
		}).then(function(){
			for( let  i in allTexts){
				var elem=document.createElement('div')
					elem.setAttribute('id','box'+i)
					elem.setAttribute('class','box')
					elem.innerHTML=allTexts[i].text
					document.getElementById('wrap-showtexts').appendChild(elem)
				var elem2=document.createElement('div')
					elem2.setAttribute('id', 'date'+i)
					elem2.setAttribute('class','date')
					elem2.innerHTML=allTexts[i].date + " " + allTexts[i].sender
					document.getElementById('wrap-showtexts').appendChild(elem2)					
			}
			window.scrollTo(0,document.body.scrollHeight)
		})
	}
	function deleteBox() {
		document.getElementById('box0').remove();
		document.getElementById('date0').remove();
		document.getElementById('box1').remove();
		document.getElementById('date1').remove();
		document.getElementById('box2').remove();
		document.getElementById('date2').remove();
		document.getElementById('box3').remove();
		document.getElementById('date3').remove();
		document.getElementById('box4').remove();
		document.getElementById('date4').remove();
	}
</script>
</html>
